<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="static/TIMENEST-05.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Catamaran:wght@100..900&family=Outfit:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
            integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
            crossorigin="anonymous" referrerpolicy="no-referrer" />
        <!-- <link rel="stylesheet" href="/static/styles/style_main.css" /> -->        
        <script src="script_main.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

        <script>
            const userID = "{{userID}}"; // This assumes the userID is passed from the Python script
            const username = "{{username}}";
            // const evtSource = new EventSource("/stream");


        </script>
        <title>Timenest</title>
    </head>
    <style>
      /* Box sizing rules */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }
      /* Remove default margin */
      * {
        margin: 0;
        padding: 0;
        font: inherit;
      }
      /* Remove list styles on ul, ol elements with a list role, which suggests default styling will be removed */
      ul[role='list'],
      ol[role='list'] {
        list-style: none;
      }
      /* Set core root defaults */
      html:focus-within {
        scroll-behavior: smooth;
      }
      html {
        scroll-behavior: smooth;
      }
      html,
      body {
        height: 100%;
      }
      /* Set core body defaults */
      body {
        text-rendering: optimizeSpeed;
        line-height: 1.5;
      }
      /* A elements that don't have a class get default styles */
      a:not([class]) {
        text-decoration-skip-ink: auto;
      }
      /* Make images easier to work with */
      img,
      picture,
      svg {
        max-width: 100%;
        display: block;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevents scrolling */
      }
      /* Remove all animations, transitions and smooth scroll for people that prefer not to see them */
      @media (prefers-reduced-motion: reduce) {
        html:focus-within {
          scroll-behavior: auto;
        }
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
      /* Go */
      html {
        font-family: 'Poppins', sans-serif;
        text-size-adjust: 100%;
      }
      body {
        background-color: #a2d2ff;
        height: 100vh;
        overflow: hidden;
        position: relative;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      button {
        cursor: pointer;
        align-items: center;
        justify-content: center;
      }
      .h__container {
        margin-top: 0.5rem;
        padding: 1rem;
        height: 40px;
        max-height: 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }
      .h-col-1 {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-basis: 20%;
      }

      .h-col-1 #logo {
        transition: transform 0.3s ease;
      }

      .h-col-1 #logo:hover {
        transform: scale(1.05);
      }
      .menu {
        margin-top: 3px;
        padding: 0.5rem;
        border: none;
        border-radius: 10px;
        background-color: transparent;
        transition: background-color 0.3s ease;
      }

      .menu:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      .group-right {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-basis: 80%;
      }
      .undo-redo {
        padding: 1rem;
        margin-top: 7px;
      }
      .redo {
        margin-left: 1rem;
      }
      .undo,
      .redo {
        border: none;
        background-color: transparent;
        border-radius: 10px;
        padding: 0.5rem;
        transition: background-color 0.3s ease;
      }

      .undo:hover,
      .redo:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      .switch {
        margin-left: 2rem;
        border: none;
        background-color: transparent;
        border-radius: 10px;
        padding: 0.5rem;
        transition: background-color 0.3s ease;
      }

      .switch:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      .group-right p {
        font-size: 20px;
        font-weight: 500;
      }
      /* sidebar */
      .main {
        padding: 1rem;
        display: flex;
        width: 100%;
        height: calc(100vh - 40px); /* Subtract header height */
        overflow: hidden;
      }

      .sidebar {
        flex: 0 0 20%; /* Fixed width of 20% */
        max-width: 20%; /* Ensure it doesn't grow beyond 20% */
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        height: 100%;
      }

      .sidebar-content__wrapper1 {
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        gap: 1rem;
      }
      .short-cut1 {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .sc-1 {
        width: 30%;
        height: 100px;
        align-items: center;
        justify-content: center;
        display: flex;
        border-radius: 17px;
        background-color: rgba(0, 0, 0, 0.15);
        border: none;
        transition: background-color 0.3s ease;
      }
      .sc-1:hover {
        background-color: rgba(0, 0, 0, 0.2);
      }
      .manage {
        font-size: 20px;
        font-weight: 600;
        width: 100%;
        border-radius: 20px;
        background-color: rgba(0, 0, 0, 0.15);
        border: none;
        height: 65px;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        transition: background-color 0.3s ease, transform 0.3s ease;
      }
      .manage:hover {
        background-color: rgba(0, 0, 0, 0.2);
      }
      .div-create {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
      }
      .create {
        font-size: 24px;
        font-weight: 600;
        color: white;
        width: 100%;
        display: flex;
        padding: 1rem;
        height: 100px;
        border-radius: 20px;
        background-color: #4361ee;
        border: none;
        gap: 1rem;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        transition: background-color 0.3s ease;
      }
      .create:hover {
        background-color: #3148e6;
      }
      .create-text {
        display: flex;
        align-items: center;
        justify-content: end;
      }

      /* ... (previous styles remain the same) ... */

      .chatbot {
        width: 100%;
        margin-bottom: 1rem;
        height: 62vh;
        background-color: white;
        border-radius: 20px;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        transition: box-shadow 0.3s ease;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
      }

      .header h1 {
        font-size: 20px;
        font-weight: 700;
        color: #4361ee;
        padding: 0.8rem;
      }

      .chat-window {
        margin-bottom: 0.5rem;
        width: 92%;
        height: 82%;
        background-color: #f8f9fa;
        border-radius: 20px;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        padding: 1rem;
      }

      .bot-message,
      .user-message {
        max-width: 80%;
        margin-bottom: 0.5rem;
        word-wrap: break-word;
      }

      .bot-message {
        align-self: flex-start;
      }

      .user-message {
        align-self: flex-end;
      }

      .bot-message p,
      .user-message p {
        font-size: 18px;
        font-weight: 400;
        padding: 12px 16px;
        display: inline-block;
        max-width: 100%;
      }

      .bot-message p {
        background-color: #dee2e6;
        border-radius: 15px 15px 15px 0;
      }

      .user-message p {
        background-color: #4361ee;
        color: white;
        border-radius: 15px 15px 0 15px;
      }

      .input-area {
        width: 92%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .input-area input {
        width: 80%;
        height: 50px;
        border: none;
        border-radius: 20px;
        padding: 0 1rem;
        font-size: 16px;
        background-color: #dee2e6;
      }

      .input-area button {
        padding: 1.1rem 1.3rem;
        background-color: #4361ee;
        border: none;
        border-radius: 15px;
        transition: transform 0.3 ease, background-color 0.3s ease;
      }

      .input-area button:hover {
        background-color: #3148e6;
        transform: scale(1.02);
      }
      .calendar-zone {
        flex: 1; /* Take up remaining space */
        display: flex;
        flex-direction: column;
        margin-left: 1rem;
        background-color: #e1f1ff;
        border-radius: 20px;
        padding: 1rem;
        height: 93.5%;
        overflow-y: auto;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
      }

      .tracker {
        width: 100%;
        display: flex;
        gap: 1rem;
        background-color: #4361ee;
        height: 40px;
        border-radius: 20px;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        align-items: center;
        justify-content: center;
        transition: transform 0.3s ease, background-color 0.3s ease;
      }
      .tracker:hover {
        background-color: #3148e6;
        transform: scaleY(1.25);
        border-radius: 15px;
      }
      .progress-container {
        width: 85%;
        background-color: #000000;
        border-radius: 15px;
        overflow: hidden;
        position: relative;
        display: flex;
        align-items: center;
      }
      .progress-bar {
        width: 75%;
        height: 7px;
        background-color: #ffffff;
        border-radius: 15px;
        transition: width 0.5s ease-in-out;
      }
      .time-period {
        position: absolute;
        left: 10px;
        color: white;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .tracker:hover .time-period {
        opacity: 1;
      }

      /* .bottom {
          margin-bottom: 0;
          width: 100%;
          gap: 2rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: 1rem;
      } */

      .Calender {
        height: 850px;
        grid-area: Calender;
        display: grid;
        grid-template-areas:
          'blank weekview_date_header'
          'time_interval time_interval';
        grid-template-columns: 1fr 14fr;
        grid-template-rows: auto 1fr;
        background-color: #ffffff;
        border-radius: 20px;
        border: none;
        padding: 1rem;
        margin-top: 1rem;
        box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
      }

      .weekview_date_header {
        grid-area: weekview_date_header;
        display: grid;
        grid-template-columns: repeat(7, 1fr);
      }

      .time_interval {
        border-top: 0px solid;
        grid-area: time_interval;
        height: 670px;
        display: grid;
        grid-template-columns: 1fr 14fr;
        overflow-y: scroll;
      }

      .time {
        border-right: 1px solid #ddd;
        .blank_time {
          height: 20px;
        }
        p {
          height: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 15px;
        }
      }

      .time-slots {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-template-rows: repeat(96, 1fr);
        height: 650px;
        position: relative;
      }

      .time-slot {
        border-right: 1px solid #ddd;
        border-top: 1px solid #eee;
        height: 20px;
      }

      .time-slot :nth-child(7n) {
        border-right: none;
      }

      .calendar-day {
        font-size: 35px;
        font-weight: 500;
        text-align: center;
      }

      .day_of_week {
        font-size: 25px;
        font-weight: 500;
        text-align: center;
      }

      .footer {
        grid-area: footer;
        background-color: #333;
        color: white;
        text-align: center;
      }

      @media (max-width: 768px) {
        body {
          grid-template-areas:
            'header'
            'Calender'
            'footer';
          grid-template-columns: 1fr;
          grid-template-rows: auto;
        }
      }

      .createTaskModal {
        display: flex;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      .createTaskModal.show {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background-color: #fefefe;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transform: scale(0.7);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .createTaskModal.show .modal-content {
        transform: scale(1);
        opacity: 1;
      }

      /* ... rest of the CSS remains the same ... */

      .close-button {
        color: #aaa;
        float: right;
        font-size: 32px;
        font-weight: bold;
        cursor: pointer;
      }

      .close-button:hover,
      .close-button:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }

      .modal-content h2 {
        padding-top: 8px;
        margin-bottom: 20px;
        color: #4361ee;
        font-size: 22px;
        font-weight: 600;
      }

      .modal-content form {
        display: flex;
        flex-direction: column;
      }

      .modal-content label {
        margin-top: 10px;
        font-weight: 500;
      }

      .modal-content input,
      .modal-content textarea {
        margin-top: 5px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        resize: none;
      }

      .modal-content button[type='submit'] {
        margin-top: 20px;
        padding: 10px;
        background-color: #4361ee;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 500;
        transition: background-color 0.3s ease;
      }

      .modal-content button[type='submit']:hover {
        background-color: #3148e6;
      }

      .modal-content input[type='color'] {
        -webkit-appearance: none;
        border: none;
        width: 32px;
        height: 32px;
        cursor: pointer;
      }

      .modal-content input[type='color']::-webkit-color-swatch-wrapper {
        padding: 0;
      }

      .modal-content input[type='color']::-webkit-color-swatch {
        border: none;
        border-radius: 50%;
      }

      .color-input-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .color-preview {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 1px solid #ddd;
      }

      .calendar-zone-top {
        display: flex;
        width: 100%;
        height: 180px;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
      }

      .calendar-zone-top .today {
        padding: 25px 55px;
        border-radius: 20px;
        background-color: #4361ee;
        transition: background-color 0.3s ease, transform 0.3s ease;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
      }

      .calendar-zone-top .today:hover {
        background-color: #3148e6;
        transform: scale(1.02);
      }

      .btn-today {
        background-color: transparent;
        border: none;
        color: white;
        font-size: 24px;
        font-weight: 600;
      }

      .calendar-zone-top .day {
        height: 85px;
        width: 320px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 20px;
        background-color: #4361ee;
        gap: 1rem;
        transition: background-color 0.3s ease, transform 0.3s ease;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
      }

      .calendar-zone-top .day:hover {
        background-color: #3148e6;
        transform: scale(1.02);
      }

      .day button {
        background-color: transparent;
        border: none;
      }

      .day p {
        color: white;
        font-size: 24px;
        font-weight: 600;
      }

      .calendar-zone-top .right {
        display: flex;
        gap: 1rem;
        justify-content: space-between;
        align-items: center;
      }

      .right .view {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        height: 85px;
        width: 160px;
        background-color: #4361ee;
        border-radius: 20px;
        font-size: 24px;
        font-weight: 600;
        color: white;
        transition: background-color 0.3s ease, transform 0.3s ease;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
      }

      .right .view:hover {
        background-color: #3148e6;
        transform: scale(1.02);
      }

      .right .view button {
        background-color: transparent;
        border: none;
        color: white;
        font-size: 24px;
        font-weight: 600;
      }

      .search {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 85px;
        width: 85px;
        background-color: #4361ee;
        border-radius: 20px;
        box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
        transition: background-color 0.3s ease, transform 0.3s ease;
      }

      .search:hover {
        background-color: #3148e6;
        transform: scale(1.02);
      }

      .s {
        background-color: transparent;
        border: none;
      }

      .time-slot.highlighted {
        background-color: rgba(67, 97, 238, 0.3);
      }

      .task {
        background-color: #4361ee;
        color: white;
        padding: 5px 10px;
        font-weight: 600;
        overflow: hidden;
        word-wrap: break-word; /* ƒê·∫£m b·∫£o n·ªôi dung d√†i s·∫Ω xu·ªëng d√≤ng */
        white-space: pre-wrap;
        z-index: 10;
        font-size: 18px;
        border-radius: 15px;
      }
      .typing-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 30px;
        width: 60px;
        padding: 5px 10px;
      }

      .typing-indicator .dot {
        width: 8px;
        height: 8px;
        margin: 0 3px;
        background-color: #888;
        border-radius: 50%;
        opacity: 0.7;
        animation: swing 1s infinite ease-in-out;
      }

      .typing-indicator .dot:nth-child(1) {
        animation-delay: 0s;
      }

      .typing-indicator .dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-indicator .dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes swing {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .right-component {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
        width: 100%;
        height: 100%;
      }

      .bottom {
        margin-right: 4rem;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
      }

      .option {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .option button {
        background-color: #e1f1ff;
        border: none;
        border-radius: 20px;
        height: 50px;
        width: 90px;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: background-color 0.3s ease;
        box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
      }

      .option button:hover {
        background-color: rgba(0, 0, 0, 0.15);
      }

      .task {
        position: relative; /* Ensure positioning context for child elements */
        border: none; /* Optional: Add a border for visibility */
        border-radius: 10px; /* Optional: Add rounded corners */
      }

      .delete-button {
        font-size: 12px;
        font-weight: 500;
        padding: 3px 7px;
        display: none; /* Hide the button by default */
        position: absolute; /* Position it relative to the task */
        top: 5px; /* Position it within the task */
        right: 5px; /* Align to the right */
      }

      .task:hover .delete-button {
        display: block; /* Show the button on hover */
      }

      .taskDescript {
        font-weight: 500; /* Adjust this to your desired weight */
        /* You can also add other styles if needed */
        font-size: 16px; /* Optional: Adjust the font size */ /* Optional: Change the text color */
      }

      .taskTime {
        font-weight: 500; /* Adjust this to your desired weight */
        /* You can also add other styles if needed */
        font-size: 16px; /* Optional: Adjust the font size */
      }

        /* .bot-message, .user-message {
            max-width: 70%;
            margin: 10px;
            padding: 10px 15px;
            border-radius: 15px 15px 15px 0;
            clear: both;
        } */

        .typing-indicator {
            max-width: 70px;
        }

        .typing-bubble {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 30px;
            width: 60px;
            background-color: #f0f0f0;
            border-radius: 20px;
            padding: 5px 10px;
        }

        .typing-bubble .dot {
            width: 8px;
            height: 8px;
            margin: 0 3px;
            background-color: #888;
            border-radius: 50%;
            opacity: 0.7;
            animation: swing 1s infinite ease-in-out;
        }

        .typing-bubble .dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-bubble .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-bubble .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes swing {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        .logout {
          background-color: transparent;
          border: none;
          margin-top: 0.5rem;
          border-radius: 10px;
          padding: 0.2rem;
          transition: background-color 0.3s ease;
        }

        .logout:hover {
          background-color: rgba(0, 0, 0, 0.1);
        }


        #workspace-display {
          margin-right: 8.5rem;
        }
        .timestamp {
            text-align: center;
            padding: 5px 10px;
            color: #a0a0a0;
            font-size: 0.8em;
            margin: 10px 0;
        }
    </style>
    <body>
        
        <div class="h__container">
            <div class="h-col-1">
                <img id="logo" src="/static/TIMENEST-05 1 Black.svg" alt="timenest" style="height: 34px;">
                <button class="menu" data-tooltip="Main menu" aria-label="button" role="button">
                    <img src="/static/Vector.svg" alt="menu button" style="height: 22px">
                </button>
                <img id="beta" src="/static/Colored Beta.svg" alt="timenest" style="height: 34px">
                <!-- <div class="beta-button">
                  <div class="beta-text">BETA</div>
                </div> -->
            </div>
            <div class="group-right">
              <div class="undo-redo">
                  <button class="undo" data-tooltip="Undo" aria-label="button" role="button">
                      <img src="/static/Undo.svg" alt="undo button" style="height: 20px">
                  </button>
                  <button class="redo" data-tooltip="Undo" aria-label="button" role="button">
                      <img src="/static/Redo.svg" alt="redo button" style="height: 20px">
                  </button>
              </div>
              <p id="workspace-display">{{username}}'s workspace</p>
              <div>
                  <button class="logout" id="logoutBtn" data-tooltip="Undo" aria-label="button" role="button">
                      <img src="/static/log-out-outline.svg" alt="logout button" style="height: 32px">
                  </button>
              </div>
          </div>
        </div>
        <main class="main">
            <div class="sidebar">
                <div class="sidebar-content__wrapper1">
                    <div class="short-cut1">
                        <button class="sc-1" aria-label="button" role="button">
                            <img src="/static/fi-ss-envelope.svg" alt="envelope">
                        </button>
                        <button class="sc-1" aria-label="button" role="button">
                            <img src="/static/fi-ss-shopping-bag.svg" alt="shopping">
                        </button>
                        <button class="sc-1" aria-label="button" role="button">
                            <img src="/static/fi-ss-basketball.svg" alt="basketball">
                        </button>
                    </div>  
                    
                    <div class="div-manage">
                        <button class="manage" aria-label="button" role="button">
                            <p>Manage</p>
                        </button>
                    </div>
                
                    <div class="div-create">
                        <button class="create" id="createBtn" aria-label="button" role="button">
                            <img src="/static/fi-ss-add.svg" alt="plus" style="width: 55px">
                            <div class="create-text">Create
                            </div>
                        </button>
                    </div>
                    
                    <div id="createTaskModal" class="createTaskModal">
                        <div class="modal-content">
                            <span class="close-button">&times;</span>
                            <h2>Create New Task</h2>
                            <form id="createTaskForm">
                                <!-- <label for="taskName">Task Name:</label>
                                <input type="text" id="taskName" name="taskName" required>
                    
                                <label for="taskDescription">Description:</label>
                                <textarea id="taskDescription" name="taskDescription" rows="3"></textarea>
                    
                                <label for="startTime">Start Time:</label>
                                <input type="datetime-local" id="startTime" name="startTime" required>
                    
                                <label for="endTime">End Time:</label>
                                <input type="datetime-local" id="endTime" name="endTime" required>
                                
                                <label for="taskColor">Task Color:</label>
            <input type="color" id="taskColor" name="taskColor" value="#4361ee">
                                <button type="submit">Create Task</button> -->
                                Task Name: <input type="text" id="taskName"><br>
                                Description: <textarea id="taskDescription"></textarea><br>
                                Start Time: <input type="datetime-local" id="startTime"><br>
                                End Time: <input type="datetime-local" id="endTime"><br>
                                Task Color: <input type="color" id="taskColor"><br>
                                <button type="submit">Create Task</button>
                            </form>
                        </div>
                    </div>
                    <div class="tracker">
                        <div class="progress-container">
                            <span class="time-period"></span>
                            <div class="progress-bar"></div>
                        </div>
                    </div>
                    <div class="chatbot">
                        <div class="header">
                            <h1>Clutch AI</h1>
                        </div>
                        <div class="chat-window">
                            <div class="bot-message">
                                <p>Hi {{username}}! How can I help you today?</p>
                            </div>
                        </div>
                        <div class="input-area">
                            <input type="text" placeholder="Type a message..." required>
                            <button class="send"><img src="/static/Arrow 1.svg"></button>
                        </div>
                    </div>
                    
                    <!-- Move this script to the end of the body -->
                    
                </div>
            </div>
            <div class="right-component">
                <div class="calendar-zone">
                    <div class="calendar-zone-top">
                        <div class="today">
                            <button class="btn-today"><p>Today</p></button>
                        </div>
                        <div class="day">
                            <button class = 'Previous_day'><img src="/static/Expand_left.svg" style="width: 35px"></button>
                            <button class = 'Next_day'><img src="/static/Expand_right.svg" style="width: 32px"></button>
                            <p>27.09.2024</p>
                        </div>
                        <div class="right">
                            <div class="view">
                                <p>Week</p>
                                <button><img src="/static/fi-ss-caret-down.svg"></button>
                            </div>
                            <div class="search">
                                <button class="s"><img src="/static/Date_range.svg" style="width: 45px"></button>
                            </div>
                        </div>
                    </div>
                    <section class="Calender">
                            <div class="Blank_part"></div>
                            <div class="weekview_date_header">
                                <div>
                                    <p class="day_of_week"></p>
                                    <p class="calendar-day"></p>
                                </div>
                                <div>
                                    <p class="day_of_week"></p>
                                    <p class="calendar-day"></p>
                                </div>
                                <div>
                                    <p class="day_of_week"></p>
                                    <p class="calendar-day"></p>
                                </div>
                                <div>
                                    <p class="day_of_week"></p>
                                    <p class="calendar-day"></p>
                                </div>
                                <div>
                                    <p class="day_of_week"></p>
                                    <p class="calendar-day"></p>
                                </div>
                                <div>
                                    <p class="day_of_week"></p>
                                    <p class="calendar-day"></p>
                                </div>
                                <div>
                                    <p class="day_of_week"></p>
                                    <p class="calendar-day"></p>
                                </div>
                            </div>
                            <div class="time_interval">
                                <div class="time">
                                </div>
                                <div class="time-slots"></div>
                            </div> 
                    </section>
                </div>
                <div class="bottom">
                    <div class="option 1">
                        <button class="bttn-option 1"><img src="/static/Add_round.svg"></button>
                    </div>
                    <div class="option 2">
                        <button class="bttn-option 2"><img src="/static/Group_fill.svg"></button>
                    </div>
                    <div class="option 3">
                        <button class="bttn-option 3"><img src="/static/Setting_alt_fill.svg"></button>
                    </div>
                </div>
            </div>
        </main>
        <script>

            document.addEventListener('DOMContentLoaded', function () {
              function deleteTask(taskData) {
                    console.log(1234)
                    // fetch('http://localhost:5004/delete-task', {
                    fetch('/delete-task', {
          
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(taskData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        // Optionally, update the calendar here or show a success message
                        getUserTasks(); // Refresh the tasks after adding a new one
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        // Handle errors here
                    });
                }
              async function addTaskFromDB() {

                    try {
                        // Fetch user data from the API
                        console.log('fetching user data');
                        const response = await fetch(`/get-user-metadata?userID=${encodeURIComponent(userID)}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });
                        const userData = await response.json();
                        console.log('UserData here', userData)
                        // Check if tasks array exists and has items
                        if (userData.tasks && userData.tasks.length > 0) {
                            userData.tasks.forEach(task => {
                                addTaskToCalendarFromDB(task);
                            });
                        }
                    } catch (error) {
                        console.error('Error fetching user data:', error);
                    }
                }

                function addTaskToCalendarFromDB(taskData) {
                    console.log('task loaded from db ',taskData);
                    const task = document.createElement('div');
                    task.classList.add('task');

                    // Task Name
                    const taskName = document.createElement('p');
                    taskName.classList.add('taskName');
                    taskName.textContent = taskData.taskName;

                    // Task Description
                    const taskDescript = document.createElement('p');
                    taskDescript.classList.add('taskDescript');
                    taskDescript.textContent = taskData.taskDescription;

                    // Parse start and end times
                    const startTime = new Date(taskData.startTime);
                    const endTime = new Date(taskData.endTime);

                    // Task Time
                    const taskTime = document.createElement('p');
                    taskTime.classList.add('taskTime');
                    taskTime.textContent = `${startTime.toLocaleTimeString([], {
                        hour: '2-digit',
                        minute: '2-digit',
                    })} - ${endTime.toLocaleTimeString([], {
                        hour: '2-digit',
                        minute: '2-digit',
                    })}`;

                    // Create Delete Button
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.classList.add('delete-button');

                    // Add event listener to delete the task
                    deleteButton.onclick = function() {
                        deleteTask(taskData);
                        timeSlots.removeChild(task);
                    };

                    // Append elements to the task
                    task.appendChild(taskName);
                    task.appendChild(taskDescript);
                    task.appendChild(taskTime);
                    task.appendChild(deleteButton);

                    // Set task color (fallback to a default color if null)
                    task.style.backgroundColor = taskData.taskcolor || '#add8e6'; // Light blue as default

                    // Calculate position and size (similar to addTaskToCalendar function)
                    const today = new Date();
                    const startDayIndex = startTime.getDate() - today.getDate() + 3;
                    const startHour = startTime.getHours();
                    const startMinute = startTime.getMinutes();
                    const startSlotIndex = (startHour * 4 + startMinute / 15) * 7 + startDayIndex;

                    const endDayIndex = endTime.getDate() - today.getDate() + 3;
                    const endHour = endTime.getHours();
                    const endMinute = endTime.getMinutes();
                    const endSlotIndex = (endHour * 4 + endMinute / 15) * 7 + endDayIndex;

                    const timeSlot = document.querySelectorAll('.time-slot');
                    const startSlotElement = timeSlot[startSlotIndex + 7];
                    const endSlotElement = timeSlot[endSlotIndex + 7];

                    // Calculate position and size
                    const startRect = startSlotElement.getBoundingClientRect();
                    const endRect = endSlotElement.getBoundingClientRect();
                    const timeSlotRect = timeSlot[0].getBoundingClientRect();

                    task.style.position = 'absolute';
                    task.style.left = `${Math.min(startRect.left, endRect.left) - timeSlotRect.left}px`;
                    task.style.top = `${Math.min(startRect.top, endRect.top) - timeSlotRect.top + 10}px`;
                    task.style.width = `${Math.max(startRect.right, endRect.right) - Math.min(startRect.left, endRect.left)}px`;
                    task.style.height = `${Math.max(startRect.bottom, endRect.bottom) - Math.min(startRect.top, endRect.top) - 20}px`;

                    // Append the task to time slots
                    const timeSlots = document.querySelector('.time-slots'); // Make sure this selector matches your HTML structure
                    timeSlots.appendChild(task);
                }
                addTaskFromDB();
                const chatbox = document.querySelector('.chatbox');
                const userInput = document.getElementById('userInput');
                const sendButton = document.getElementById('sendButton');


                function sendMessage() {
                  const message = userInput.value.trim();
                  if (message !== '') {
                    // Create and append the user's message
                    const userMessageLi = document.createElement('li');
                    userMessageLi.className = 'chat outgoing';
                    userMessageLi.innerHTML = `<p>${message}</p>`;
                    chatbox.appendChild(userMessageLi);
              
                    // Clear the input field
                    userInput.value = '';
              
                    // Scroll to the bottom of the chatbox
                    chatbox.scrollTop = chatbox.scrollHeight;
              
                    // Here you would typically send the message to your backend
                    // and wait for a response. For now, we'll just add a placeholder response.
                    setTimeout(() => {
                      const botMessageLi = document.createElement('li');
                      botMessageLi.className = 'chat incoming';
                      botMessageLi.innerHTML =
                        '<p>I received your message. How can I assist you further?</p>';
                      chatbox.appendChild(botMessageLi);
                      chatbox.scrollTop = chatbox.scrollHeight;
                    }, 1000);
                  }
                }
              
                // Event listener for the send button
                sendButton.addEventListener('click', sendMessage);
              
                // Event listener for the Enter key in the input field
                userInput.addEventListener('keypress', function (e) {
                  if (e.key === 'Enter') {
                    sendMessage();
                  }
                });
              });

              
              // Modal functionality
              const modal = document.getElementById('createTaskModal');
              const btn = document.getElementById('createBtn');
              const span = document.getElementsByClassName('close-button')[0];
              const logout = document.getElementById('logoutBtn');

              logout.onclick = function() {
                  window.location.href = "/create-account"
              }
              let alertShown = false;

              btn.onclick = function () {
                    if (!alertShown) {
                        alert("When creating a task, your minutes range must be incremented by 15, else your task won't be displayed on the calendar. This is a special feature of our unique website, not a bug ü´∂");
                        
                        alertShown = true;
                    }
                    
                    modal.classList.add('show');
                };
                function closeModal() {
                    modal.classList.remove('show');
                    document.getElementById('createTaskForm').reset();
              }
              
              span.onclick = closeModal;
              
              window.onclick = function (event) {
                if (event.target == modal) {
                  closeModal();
                }
              };
              
              // Form submission
              document.getElementById('createTaskForm').onsubmit = function (e) {
                e.preventDefault();
                console.log('Task Name:', document.getElementById('taskName').value);
                console.log('Description:', document.getElementById('taskDescription').value);
                console.log('Start Time:', document.getElementById('startTime').value);
                console.log('End Time:', document.getElementById('endTime').value);
              
                // Close the modal after submission
                closeModal();
              
                // Reset the form
                this.reset();
              };
              
              // Function to get the start of the centered week for a given date
              function getStartOfCenteredWeek(date) {
                const start = new Date(date);
                start.setDate(start.getDate() - 3); // Move back 3 days to start from Tuesday
                return start;
              }
              
              // Function to format date as "DD"
              function formatDate(date) {
                return date.getDate().toString().padStart(2, '0');
              }
              
              document.addEventListener('DOMContentLoaded', function () {
                // Get the current date (in this case, 27.09.2024)
                const currentDate = new Date();
              
                // Function to format date as "DD"
                function formatDate(date) {
                  return date.getDate().toString().padStart(2, '0');
                }
              
                function getDayOfWeek(date) {
                  const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                  return daysOfWeek[date.getDay()];
                }
              
                // Get the start of the centered week
                const weekStart = getStartOfCenteredWeek(currentDate);
              
                // Function to get the start of the centered week
                function getStartOfCenteredWeek(date) {
                  const start = new Date(date);
                  start.setDate(start.getDate() - 3); // Move back 3 days to start from Tuesday
                  return start;
                }
              
                // Update the calendar
                const dayElements = document.querySelectorAll('.calendar-day');
                const dayOfWeekElements = document.querySelectorAll('.day_of_week');
              
                dayElements.forEach((element, index) => {
                  const date = new Date(weekStart);
                  date.setDate(weekStart.getDate() + index);
              
                  // Store the full date (DD/MM/YYYY) in the data attribute
                  element.setAttribute('data-full-date', date.toISOString());
              
                  // Display only the day (DD)
                  element.textContent = formatDate(date);
              
                  // Highlight the current day
                  if (date.toDateString() === currentDate.toDateString()) {
                    element.style.color = '#4361ee';
                    element.style.fontWeight = 'bold';
                  }
              
                  // Update the day names (Mon, Tue, etc.) based on the correct date
                  const dayOfWeek = getDayOfWeek(date);
                  dayOfWeekElements[index].textContent = dayOfWeek;
                });
              });
              
              document.addEventListener('DOMContentLoaded', function () {
                const timeSlots = document.querySelector('.time-slots');
                const timeInterval = document.querySelector('.time_interval .time');
                const modal = document.getElementById('createTaskModal');
                const startTimeInput = document.getElementById('startTime');
                const endTimeInput = document.getElementById('endTime');
                const dayElements = document.querySelectorAll('.calendar-day');
              
                // Initialize drag functionality
                let isDragging = false;
                let startSlot = null;
                let endSlot = null;
                let newStart = null;
                let newEnd = null;
                // Create time intervals and time slots
                createTimeIntervalsAndSlots();
              
                // Event Listeners
                timeSlots.addEventListener('mousedown', onMouseDown);
                timeSlots.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
                document.getElementsByClassName('close-button')[0].onclick = closeModal;
                window.onclick = function (event) {
                  if (event.target == modal) {
                    closeModal();
                  }
                };
              
                // Functions for handling time slots
                function createTimeIntervalsAndSlots() {
                  // T·∫°o kho·∫£ng tr·ªëng ƒë·∫ßu ti√™n
                  const timeblank1 = document.createElement('div');
                  timeblank1.classList.add('blank_time');
                  timeInterval.appendChild(timeblank1);
              
                  for (let j = 0; j < 7; j++) {
                    const timeSlot = document.createElement('div');
                    //Th√™m border-right cho c√°c timeSlot th·ª© 2 v√† 4
                    timeSlot.style.height = '30px';
                    timeSlot.style.borderRight = '1px solid #ddd'; // B·ªè border bottom
                    timeSlots.appendChild(timeSlot);
                  }
              
                  for (let i = 0; i < 96; i++) {
                    const hours = Math.floor(i / 4); // L·∫•y gi·ªù t·ª´ ch·ªâ s·ªë
                    const minutes = (i % 4) * 15; // L·∫•y ph√∫t t·ª´ ch·ªâ s·ªë
                    const timeElement = document.createElement('p');
              
                    // Hi·ªÉn th·ªã gi·ªù m·ªói khi s·ªë ph√∫t l√† 0 (b·∫Øt ƒë·∫ßu m·ªói gi·ªù)
                    if (i % 4 === 0) {
                      timeElement.textContent = formatTimeForDisplay(hours, minutes);
                    }
                    timeInterval.appendChild(timeElement);
              
                    // T·∫°o c√°c timeSlot cho m·ªói ng√†y trong tu·∫ßn (7 ng√†y)
                    dayElements.forEach((dayElement, j) => {
                      const timeSlot = document.createElement('div');
                      timeSlot.classList.add('time-slot');
              
                      // L·∫•y th√¥ng tin ng√†y t·ª´ ph·∫ßn t·ª≠ dayElement
                      const day = dayElement.textContent; // L·∫•y gi√° tr·ªã ng√†y (DD)
                      const month = new Date().getMonth() + 1; // L·∫•y th√°ng hi·ªán t·∫°i
                      const year = new Date().getFullYear(); // L·∫•y nƒÉm hi·ªán t·∫°i
              
                      // G√°n ng√†y th√°ng v√† gi·ªù ph√∫t v√†o dataset
                      timeSlot.dataset.date = `${day}-${month
                        .toString()
                        .padStart(2, '0')}-${year}`; // Ng√†y th√°ng nƒÉm
                      timeSlot.dataset.time = formatTimeForInput(hours, minutes); // Gi·ªù ph√∫t
                      timeSlot.dataset.day = j; // G√°n ch·ªâ s·ªë ng√†y (0-6)
              
                      // Th√™m border-right cho c√°c timeSlot th·ª© 2 v√† 4
                      if (i % 4 === 1 || i % 4 === 3) {
                        timeSlot.style.borderTop = '0px solid'; // B·ªè border bottom
                      }
              
                      timeSlots.appendChild(timeSlot);
                    });
                  }
              
                  // T·∫°o kho·∫£ng tr·ªëng cu·ªëi c√πng
                  const timeblank2 = document.createElement('div');
                  timeblank2.classList.add('blank_time');
                  timeInterval.appendChild(timeblank2);
                }
              
                function formatTimeForInput(hours, minutes) {
                  return `${hours
                    .toString()
                    .padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                }
              
                function formatTimeForDisplay(hours, minutes) {
                  return `${hours
                    .toString()
                    .padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                }
              
                function getTimeFromSlot(slot) {
                  const slotIndex = Array.from(timeSlots.children).indexOf(slot);
                  const hours = Math.floor(slotIndex / 4);
                  const minutes = (slotIndex % 4) * 15;
                  return { hours, minutes };
                }
              
                function highlightSlot(slot) {
                  slot.classList.add('highlighted');
                }
              
                function highlightRange(start, end) {
                  clearHighlight();
                  const slots = Array.from(timeSlots.children);
                  const startIndex = slots.indexOf(start);
                  const endIndex = slots.indexOf(end);
              
                  const [row1, row2] = [
                    Math.floor(startIndex / 7) - 1,
                    Math.floor(endIndex / 7),
                  ].sort((a, b) => a - b);
                  const [col1, col2] = [startIndex % 7, endIndex % 7].sort((a, b) => a - b);
              
                  for (let i = row1 + 1; i <= row2; i++) {
                    for (let j = col1; j <= col2; j++) {
                      slots[i * 7 + j].classList.add('highlighted');
                    }
                  }
                  newStart = row1 * 7 + col1;
                  newEnd = row2 * 7 + col2;
                }
              
                function clearHighlight() {
                  timeSlots
                    .querySelectorAll('.highlighted')
                    .forEach((slot) => slot.classList.remove('highlighted'));
                }
              
                // Event handling functions
                function onMouseDown(e) {
                  if (e.target.classList.contains('time-slot')) {
                    isDragging = true;
                    startSlot = e.target;
                    highlightSlot(startSlot);
                  }
                }
              
                function onMouseMove(e) {
                  if (isDragging && e.target.classList.contains('time-slot')) {
                    endSlot = e.target;
                    highlightRange(startSlot, endSlot);
                  }
                }
              
                function onMouseUp() {
                  if (isDragging) {
                    isDragging = false;
                    if (startSlot && endSlot) {
                      const startTime = getTimeFromSlot(startSlot); 
                      console.log('startTime',startTime);
                      const endTime = getTimeFromSlot(endSlot);
                      console.log('endTime',endTime);
                      console.log(startTime.minutes);
                      // Pre-fill the modal with the captured time
                      startTimeInput.value = formatTimeForInput(
                        startTime.hours,
                        startTime.minutes
                      );
                      endTimeInput.value = formatTimeForInput(endTime.hours, endTime.minutes);
                      console.log('fasfasfsdf');
                      createTask();
                    }
                    clearHighlight();
                  }
                }
              
                // Modal functions
                function closeModal() {
                  modal.classList.remove('show');
                  document.getElementById('createTaskForm').reset();
                  clearHighlight();
                }
              
                function createTask() {
                  console.log(`hahah ${newStart} - ${newEnd}`);
                  if (newStart != null && newEnd != null) {
                    const timeSlot = document.querySelectorAll('.time-slot');
              
                    const startSlotElement = timeSlot[newStart];
                    const endSlotElement = timeSlot[newEnd];
              
                    // L·∫•y ng√†y v√† th·ªùi gian t·ª´ c√°c ph·∫ßn t·ª≠ time-slot
                    const startDateValue = startSlotElement
                      ? startSlotElement.dataset.date
                      : null;
                    const startTimeValue = startSlotElement
                      ? startSlotElement.dataset.time
                      : null;
              
                    const endDateValue = endSlotElement ? endSlotElement.dataset.date : null;
                    const endTimeValue = endSlotElement ? endSlotElement.dataset.time : null;
              
                    if (startDateValue && startTimeValue && endDateValue && endTimeValue) {
                      // Chuy·ªÉn ƒë·ªïi date t·ª´ ƒë·ªãnh d·∫°ng DD-MM-YYYY sang YYYY-MM-DD
                      const [startDay, startMonth, startYear] = startDateValue.split('-');
                      const [endDay, endMonth, endYear] = endDateValue.split('-');
              
                      const formattedStartDate = `${startYear}-${startMonth}-${startDay}`;
                      const formattedEndDate = `${endYear}-${endMonth}-${endDay}`;
              
                      // K·∫øt h·ª£p th√†nh chu·ªói datetime-local
                      const startDateTime = `${formattedStartDate} ${startTimeValue}`;
                      const endDateTime = `${formattedEndDate} ${endTimeValue}`;
              
                      // G√°n gi√° tr·ªã v√†o c√°c tr∆∞·ªùng input datetime-local
                      document.getElementById('startTime').value = startDateTime;
                      document.getElementById('endTime').value = endDateTime;
              
                      // In ra ƒë·ªÉ ki·ªÉm tra
                      console.log(`Th·ªùi gian b·∫Øt ƒë·∫ßu: ${startDateTime}`);
                      console.log(`Th·ªùi gian k·∫øt th√∫c: ${endDateTime}`);
                    }
                  }
                  modal.classList.add('show');
                  document.getElementById('createTaskForm').onsubmit();
                }
              
                document.getElementById('createTaskForm').onsubmit = function (e) {
                  e.preventDefault();
                  addTaskToCalendar();
                  closeModal();
                  document.getElementById('createTaskForm').reset();
                };
                function addTask(taskData) {
                        console.log("task Data to api: ",taskData)
                        // fetch('http://localhost:5004/add-task', {
                        fetch('/add-task', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(taskData)
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Success:', data);
                            // Optionally, update the calendar here or show a success message
                            getUserTasks(); // Refresh the tasks after adding a new one
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                            // Handle errors here
                        });
                    }
                function deleteTask(taskData) {
                    console.log(1234)
                    // fetch('http://localhost:5004/delete-task', {
                    fetch('/delete-task', {
          
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(taskData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        // Optionally, update the calendar here or show a success message
                        getUserTasks(); // Refresh the tasks after adding a new one
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        // Handle errors here
                    });
                }

                function addTaskToCalendar() {
                  const task = document.createElement('div');
                  task.classList.add('task');
              
                  // Task Name
                  const taskName = document.createElement('p');
                  taskName.classList.add('taskName');
                  taskName.textContent = document.getElementById('taskName').value;
              
                  // Task Description
                  const taskDescript = document.createElement('p');
                  taskDescript.classList.add('taskDescript');
                  taskDescript.textContent = document.getElementById('taskDescription').value;
              
                  // L·∫•y th·ªùi gian b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c
                  const startTimeValue = startTimeInput.value; // Gi√° tr·ªã th·ªùi gian b·∫Øt ƒë·∫ßu (datetime)
                  const endTimeValue = endTimeInput.value; // Gi√° tr·ªã th·ªùi gian k·∫øt th√∫c (datetime)
                  console.log('Gia tri thoi gian bat dau: ',startTimeValue);
                  console.log('Gia tri thoi gian ket thuc: ',endTimeValue);

                  const startTime = new Date(startTimeValue);
                  const endTime = new Date(endTimeValue);
                  console.log('Gia tri start sau chuyen doi: ',startTime);
                  console.log('Gia tri end sau chuyen doi: ', endTime);
            
              
                  // Task Time
                  const taskTime = document.createElement('p');
                  taskTime.classList.add('taskTime');
                  taskTime.textContent = `${startTime.toLocaleTimeString([], {
                    hour: '2-digit',
                    minute: '2-digit',
                  })} - ${endTime.toLocaleTimeString([], {
                    hour: '2-digit',
                    minute: '2-digit',
                  })}`;
                  const taskData = {
                        userID: userID,
                        taskName: taskName.textContent,
                        taskDescription: taskDescript.textContent,
                        taskColor: document.getElementById('taskColor').value,
                        startTime: startTime,
                        endTime: endTime,
          
                    };
                  console.log("Task Data here:", taskData)
                  addTask(taskData);
              
                  // Create Delete Button
                  const deleteButton = document.createElement('button');
                  deleteButton.textContent = 'Delete';
                  deleteButton.classList.add('delete-button');
              
                  // Add event listener to delete the task
                  deleteButton.onclick = function() {
                        const taskData = {
                            userID: userID,
                            taskName: taskName.textContent,
                            taskDescription: taskDescript.textContent,
                            startTime: startTime,
                            endTime: endTime,
                            // taskColor: document.getElementById('taskColor').value
                        };
                        // console.log(taskData)
                        deleteTask(taskData);
                        timeSlots.removeChild(task);
                    };
              
                  // Append elements to the task
                  task.appendChild(taskName);
                  task.appendChild(taskDescript);
                  task.appendChild(taskTime);
                  task.appendChild(deleteButton);
                  task.style.backgroundColor = document.getElementById('taskColor').value;
                  const today = new Date();
                  // T√¨m c√°c ph·∫ßn t·ª≠ time-slot t∆∞∆°ng ·ª©ng
                  const startDayIndex = startTime.getDate() - today.getDate() + 3; // Ng√†y trong tu·∫ßn (0-6)
                  const startHour = startTime.getHours();
                  const startMinute = startTime.getMinutes();
                  const startSlotIndex =
                    (startHour * 4 + startMinute / 15) * 7 + startDayIndex; // T·ªïng ch·ªâ s·ªë time-slot
              
                  const endDayIndex = endTime.getDate() - today.getDate() + 3;
                  const endHour = endTime.getHours();
                  const endMinute = endTime.getMinutes();
                  const endSlotIndex = (endHour * 4 + endMinute / 15) * 7 + endDayIndex; // T·ªïng ch·ªâ s·ªë time-slot
                  console.log(`StartTime: ${startDayIndex} - ${startHour} - ${startMinute}`);
                  console.log(`EndTime: ${endDayIndex} - ${endHour} - ${endMinute}`);
                  console.log(`hahaha ${startSlotIndex} - ${endSlotIndex}`);
                  const timeSlot = document.querySelectorAll('.time-slot');
              
                  // T√¨m c√°c time-slot t∆∞∆°ng ·ª©ng
                  const startSlotElement = timeSlot[startSlotIndex + 7];
                  const endSlotElement = timeSlot[endSlotIndex + 7];
              
                  // T√≠nh to√°n v·ªã tr√≠ c·ªßa task
                  const startRect = startSlotElement.getBoundingClientRect();
                  const endRect = endSlotElement.getBoundingClientRect();
                  const timeSlotRect = timeSlot[0].getBoundingClientRect();
                  // Gi·∫£ s·ª≠ th·ªùi gian b·∫Øt ƒë·∫ßu l√† ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n
              
                  task.style.position = 'absolute';
                  task.style.left = `${
                    Math.min(startRect.left, endRect.left) - timeSlotRect.left
                  }px`;
                  task.style.top = `${
                    Math.min(startRect.top, endRect.top) - timeSlotRect.top + 10 
                  }px`;
                  task.style.width = `${
                    Math.max(startRect.right, endRect.right) -
                    Math.min(startRect.left, endRect.left)
                  }px`;
                  task.style.height = `${
                    Math.max(startRect.bottom, endRect.bottom) -
                    Math.min(startRect.top, endRect.top) - 20
                  }px`;
              
                  // Append the task to time slots
                  timeSlots.appendChild(task);
                }
              });
              
              document.addEventListener('DOMContentLoaded', function () {
                // Get today's date
                const currentDate = new Date();
              
                // Function to format date as "DD.MM.YYYY"
                function formatDate(date) {
                  const day = date.getDate().toString().padStart(2, '0'); // Get day and pad with zero
                  const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Get month (0-based) and pad
                  const year = date.getFullYear(); // Get full year
                  return `${day}.${month}.${year}`; // Return formatted date
                }
              
                // Select the <p> element inside the .day div
                const dayElement = document.querySelector('.day p');
              
                // Set the text content to today's date
                dayElement.textContent = formatDate(currentDate);
              });
              function addDateTimeIndicator() {
                  const dateTimeDiv = document.createElement('div');
                  dateTimeDiv.className = 'timestamp';
                  const now = new Date();
                  const options = { 
                      weekday: 'short',
                      hour: '2-digit', 
                      minute: '2-digit'
                  };
                  dateTimeDiv.textContent = now.toLocaleString('en-US', options);
                  
                  // Insert after the first message
                  const firstMessage = chatWindow.querySelector('.bot-message, .user-message');
                  if (firstMessage) {
                      firstMessage.insertAdjacentElement('afterend', dateTimeDiv);
                  } else {
                      chatWindow.appendChild(dateTimeDiv);
                  }
              }
              document.addEventListener('DOMContentLoaded', function () {
                const chatWindow = document.querySelector('.chat-window');
                const inputField = document.querySelector('.input-area input');
                const sendButton = document.querySelector('.input-area button');

                function saveConversation(user_id) {
                  const messages = Array.from(chatWindow.children).map(child => {
                    if (child.classList.contains('timestamp')) {
                      return { type: 'timestamp', text: child.textContent };
                    } else {
                      return {
                        type: 'message',
                        text: child.querySelector('p').textContent,
                        isUser: child.classList.contains('user-message')
                      };
                    }
                  });
                  const conversationData = {
                    user_id: user_id,
                    messages: messages  // Fixed typo: 'messange' to 'messages'
                  }
                  localStorage.setItem(`chatConversation_${user_id}`, JSON.stringify(conversationData));
                }


                function loadConversation(user_id) {
                  const savedConversation = localStorage.getItem(`chatConversation_${user_id}`);
                  if (savedConversation) {
                    const conversationData = JSON.parse(savedConversation);
                    const messages = conversationData.messages;
                    chatWindow.innerHTML = ''; // Clear existing messages
                    messages.forEach(item => {
                      if (item.type === 'timestamp') {
                        const dateTimeDiv = document.createElement('div');
                        dateTimeDiv.className = 'timestamp';
                        dateTimeDiv.textContent = item.text;
                        chatWindow.appendChild(dateTimeDiv);
                      } else {
                        addMessage(item.text, item.isUser, false);
                      }
                    });
                  }
                }
                function addMessage(message, isUser = false, shouldSave = true) {
                  const messageDiv = document.createElement('div');
                  messageDiv.className = isUser ? 'user-message' : 'bot-message';
                  messageDiv.innerHTML = `<p>${message}</p>`;
                  chatWindow.appendChild(messageDiv);
                  chatWindow.scrollTop = chatWindow.scrollHeight;

                  if (shouldSave && typeof userID !== 'undefined') {
                    saveConversation(userID);
                  }
                }

                function addTypingIndicator() {
                  const typingDiv = document.createElement('div');
                  typingDiv.className = 'bot-message typing-indicator';
                  typingDiv.innerHTML =
                    '<div class="typing-bubble"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
                  chatWindow.appendChild(typingDiv);
                  chatWindow.scrollTop = chatWindow.scrollHeight;
                }

                function removeTypingIndicator() {
                  const typingIndicator = document.querySelector('.typing-indicator');
                  if (typingIndicator) {
                    typingIndicator.remove();
                  }
                }

                async function handleUserInput() {
                  const userMessage = inputField.value.trim();
                  if (userMessage) {
                    console.log(userMessage);
                    addMessage(userMessage, true);
                    inputField.value = '';

                    addTypingIndicator();

                    try {
                      const response = await fetch(`/infer`, {
                        method: 'POST',
                        headers: {
                          'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ input: userMessage, ID: userID }),
                      });

                      if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                      }

                      const data = await response.json();

                      removeTypingIndicator();
                      addMessage(data.response);
                    } catch (error) {
                      console.error('Error:', error);

                      removeTypingIndicator();
                      addMessage('Sorry, there was an error processing your message.');
                    }
                  }
                }

                sendButton.addEventListener('click', handleUserInput);

                inputField.addEventListener('keypress', function (e) {
                  if (e.key === 'Enter') {
                    handleUserInput();
                  }
                });
                loadConversation(userID);
                addDateTimeIndicator();

              });

              const tracker = document.querySelector('.tracker');
              const progressBar = document.querySelector('.progress-bar');
              const timePeriod = document.querySelector('.time-period');
              
              // Sample data (you can replace this with real data)
              const tasksData = {
                week: 35,
                month: 120,
                total: 200,
              };
              
              // Set initial progress
              const progress = (tasksData.month / tasksData.total) * 100;
              progressBar.style.width = `${progress}%`;
              
              let isShowingWeek = true;
              function updateProgressInfo() {
                if (isShowingWeek) {
                  timePeriod.textContent = `Week (${tasksData.week})`;
                } else {
                  timePeriod.textContent = `Month (${tasksData.month})`;
                }
                isShowingWeek = !isShowingWeek;
              }
              
              tracker.addEventListener('mouseenter', () => {
                updateProgressInfo();
              });
              
              tracker.addEventListener('mouseover', () => {
                if (!timePeriod.style.opacity || timePeriod.style.opacity === '0') {
                  updateProgressInfo();
                }
              });
              
              setInterval(() => {
                if (tracker.matches(':hover')) {
                  updateProgressInfo();
                }
              }, 2000); // Switch between week and month data every 2 seconds while hovering
        </script>
        <script>
          function deleteTask(taskData) {
                  console.log(1234)
                  // fetch('http://localhost:5004/delete-task', {
                  fetch('/delete-task', {
        
                      method: 'DELETE',
                      headers: {
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify(taskData)
                  })
                  .then(response => response.json())
                  .then(data => {
                      console.log('Success:', data);
                      // Optionally, update the calendar here or show a success message
                      getUserTasks(); // Refresh the tasks after adding a new one
                  })
                  .catch((error) => {
                      console.error('Error:', error);
                      // Handle errors here
                  });
              }
          function addTaskToCalendarFromDB(taskData) {
              console.log('task data passed ',taskData);
              const task = document.createElement('div');
              task.classList.add('task');

              // Task Name
              const taskName = document.createElement('p');
              taskName.classList.add('taskName');
              taskName.textContent = taskData.taskName;

              // Task Description
              const taskDescript = document.createElement('p');
              taskDescript.classList.add('taskDescript');
              taskDescript.textContent = taskData.taskDescription;

              // Parse start and end times
              const startTime = new Date(taskData.startTime.replace('Z', ''));
              const endTime = new Date(taskData.endTime.replace('Z', ''));
              console.log('parsed start time',startTime)
              console.log('parsed end time',endTime)

              // Task Time
              const taskTime = document.createElement('p');
              taskTime.classList.add('taskTime');
              taskTime.textContent = `${startTime.toLocaleTimeString([], {
                  hour: '2-digit',
                  minute: '2-digit',
                  // hour12: false,
                  // timeZone: 'UTC'
              })} - ${endTime.toLocaleTimeString([], {
                  hour: '2-digit',
                  minute: '2-digit',
                  // hour12: false,
                  // timeZone: 'UTC'
              })}`;


              // Create Delete Button
              const deleteButton = document.createElement('button');
              deleteButton.textContent = 'Delete';
              deleteButton.classList.add('delete-button');

              // Add event listener to delete the task
              deleteButton.onclick = function() {
                  deleteTask(taskData);
                  timeSlots.removeChild(task);
              };

              // Append elements to the task

              task.appendChild(taskName);
              task.appendChild(taskDescript);
              task.appendChild(taskTime);
              task.appendChild(deleteButton);

              // Set task color (fallback to a default color if null)
              task.style.backgroundColor = taskData.taskcolor || '#add8e6'; // Light blue as default

              // Calculate position and size (similar to addTaskToCalendar function)
              const today = new Date();
              const startDayIndex = startTime.getDate() - today.getDate() + 3;
              const startHour = startTime.getHours();
              const startMinute = startTime.getMinutes();
              const startSlotIndex = (startHour * 4 + startMinute / 15) * 7 + startDayIndex;

              const endDayIndex = endTime.getDate() - today.getDate() + 3;
              const endHour = endTime.getHours();
              const endMinute = endTime.getMinutes();
              const endSlotIndex = (endHour * 4 + endMinute / 15) * 7 + endDayIndex;

              const timeSlot = document.querySelectorAll('.time-slot');
              const startSlotElement = timeSlot[startSlotIndex + 7];
              const endSlotElement = timeSlot[endSlotIndex + 7];

              // Calculate position and size
              const startRect = startSlotElement.getBoundingClientRect();
              const endRect = endSlotElement.getBoundingClientRect();
              const timeSlotRect = timeSlot[0].getBoundingClientRect();

              task.style.position = 'absolute';
              task.style.left = `${Math.min(startRect.left, endRect.left) - timeSlotRect.left}px`;
              task.style.top = `${Math.min(startRect.top, endRect.top) - timeSlotRect.top + 10}px`;
              task.style.width = `${Math.max(startRect.right, endRect.right) - Math.min(startRect.left, endRect.left)}px`;
              task.style.height = `${Math.max(startRect.bottom, endRect.bottom) - Math.min(startRect.top, endRect.top) - 20}px`;

              // Append the task to time slots
              const timeSlots = document.querySelector('.time-slots'); // Make sure this selector matches your HTML structure
              timeSlots.appendChild(task);
          }
          const socket = io();
          socket.on('connect', () => {
              console.log('Connected to server');
          });
          socket.on('new_data', (taskData) => {
            console.log('WENT HEREEE')
            console.log('taskData HEREEE',taskData);
            addTaskToCalendarFromDB(taskData);
          });
          
      </script>
    </body>
</html>